import { useEffect, useState } from "react";
import api from "../../../api/api";
import { Dish } from "@/types/Types";

const useFetchDishes = (searchQuery = "") => {
  const [dishes, setDishes] = useState<Dish[]>([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [nextPage, setNextPage] = useState<string | null>(null);

  const fetchDishes = async (url: string) => {
    if (!url) return;

    setLoading(true);
    try {
      const { data } = await api.get(url);
      setDishes((prev) => [...prev, ...data.results]);
      setNextPage(data.next || null);
    } catch (err) {
      console.error("❌ Fetch Dishes Error:", err);
      setError("Failed to fetch dishes");
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    setDishes([]); // Reset when search query changes
    setNextPage(`/api/dish/?search=${searchQuery}`);
  }, [searchQuery]);

  useEffect(() => {
    if (nextPage) fetchDishes(nextPage);
  }, [nextPage]);

  return { dishes, loading, error, fetchDishes, hasMore: !!nextPage };
};

export default useFetchDishes;
